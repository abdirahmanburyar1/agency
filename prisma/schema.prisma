generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id                    String                 @id @default(cuid())
  subdomain             String                 @unique @map("subdomain")
  name                  String                 @map("name")
  status                String                 @default("active") @map("status")
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  // Client Information
  contactName           String?                @map("contact_name")
  contactEmail          String?                @map("contact_email")
  contactPhone          String?                @map("contact_phone")
  companyAddress        String?                @map("company_address")
  companyCity           String?                @map("company_city")
  companyCountry        String?                @map("company_country")
  taxId                 String?                @map("tax_id")
  businessType          String?                @map("business_type")
  websiteUrl            String?                @map("website_url")
  notes                 String?                @map("notes")
  cargoLocations        CargoLocation[]
  cargoSequences        CargoSequence[]
  cargoShipments        CargoShipment[]
  currencyRates         CurrencyRate[]
  customers             Customer[]
  documents             Document[]
  employees             Employee[]
  expenses              Expense[]
  hajUmrahBookings      HajUmrahBooking[]
  hajUmrahCampaigns     HajUmrahCampaign[]
  hajUmrahPackages      HajUmrahPackage[]
  payables              Payable[]
  payments              Payment[]
  roles                 Role[]
  settings              Setting[]
  systemSettings        SystemSetting[]
  tickets               Ticket[]
  users                 User[]
  visas                 Visa[]
  subscriptions         Subscription[]
  subscriptionPayments  SubscriptionPayment[]

  @@map("tenants")
}

model User {
  id               String             @id @default(cuid())
  email            String
  passwordHash     String             @map("password_hash")
  name             String?
  roleId           String             @map("role_id")
  userType         String?            @map("user_type")
  isActive         Boolean            @default(true) @map("is_active")
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")
  locationId       String?            @map("location_id")
  branchId         String?            @map("branch_id")
  tenantId         String?            @map("tenant_id")
  isPlatformAdmin  Boolean            @default(false) @map("is_platform_admin")
  documents        Document[]
  approvedExpenses Expense[]
  ledCampaigns     HajUmrahCampaign[]
  branch           Branch?            @relation(fields: [branchId], references: [id])
  location         CargoLocation?     @relation(fields: [locationId], references: [id])
  role             Role               @relation(fields: [roleId], references: [id])
  tenant           Tenant?            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, email])
  @@index([tenantId])
  @@map("users")
}

model Role {
  id          String           @id @default(cuid())
  name        String
  description String?
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  tenantId    String?          @map("tenant_id")
  permissions RolePermission[]
  tenant      Tenant?          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users       User[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("roles")
}

model Permission {
  id        String           @id @default(cuid())
  code      String           @unique
  name      String
  resource  String           @map("resource")
  action    String           @map("action")
  createdAt DateTime         @default(now()) @map("created_at")
  roles     RolePermission[]

  @@map("permissions")
}

model RolePermission {
  roleId       String     @map("role_id")
  permissionId String     @map("permission_id")
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([roleId, permissionId])
  @@map("role_permissions")
}

model SystemSetting {
  key       String   @map("key")
  value     String?  @map("value")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
  id        String   @id @default(cuid())
  tenantId  String   @map("tenant_id")
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, key])
  @@index([tenantId])
  @@map("system_settings")
}

model CurrencyRate {
  id        String   @id @default(cuid())
  currency  String   @map("currency")
  rateToUsd Decimal  @map("rate_to_usd") @db.Decimal(12, 6)
  updatedAt DateTime @updatedAt @map("updated_at")
  tenantId  String   @map("tenant_id")
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, currency])
  @@index([tenantId])
  @@map("currency_rates")
}

model Setting {
  id        String   @id @default(cuid())
  type      String   @map("type")
  value     String   @map("value")
  sortOrder Int      @default(0) @map("sort_order")
  createdAt DateTime @default(now()) @map("created_at")
  tenantId  String   @map("tenant_id")
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, type, value])
  @@index([tenantId])
  @@index([type])
  @@map("settings")
}

model Document {
  id         String   @id @default(cuid())
  entityType String   @map("entity_type")
  entityId   String   @map("entity_id")
  imageKitId String   @map("image_kit_id")
  url        String
  fileName   String   @map("file_name")
  createdAt  DateTime @default(now()) @map("created_at")
  createdBy  String?  @map("created_by")
  tenantId   String   @map("tenant_id")
  user       User?    @relation(fields: [createdBy], references: [id])
  tenant     Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([entityType, entityId])
  @@map("documents")
}

model Customer {
  id               String            @id @default(cuid())
  name             String            @map("name")
  phone            String?           @map("phone")
  createdAt        DateTime          @default(now()) @map("created_at")
  whatsappNumber   String?           @map("whatsapp_number")
  tenantId         String            @map("tenant_id")
  tenant           Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  hajUmrahBookings HajUmrahBooking[]
  tickets          Ticket[]
  visas            Visa[]

  @@index([tenantId])
  @@map("customers")
}

model Employee {
  id        String    @id @default(cuid())
  name      String    @map("name")
  role      String?   @map("role")
  phone     String?   @map("phone")
  email     String?   @map("email")
  createdAt DateTime  @default(now()) @map("created_at")
  tenantId  String    @map("tenant_id")
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  expenses  Expense[]

  @@index([tenantId])
  @@map("employees")
}

model Ticket {
  id           String             @id @default(cuid())
  ticketNumber Int?               @map("ticket_number")
  reference    String             @default("") @map("reference")
  date         DateTime           @map("date")
  month        String             @map("month")
  invoice      String?            @map("invoice")
  sponsor      String?            @map("sponsor")
  customerId   String?            @map("customer_id")
  customerName String?            @map("customer_name")
  airline      String?            @map("airline")
  route        String?            @map("route")
  flight       String?            @map("flight")
  departure    DateTime?          @map("departure")
  return       DateTime?          @map("return")
  netCost      Decimal            @map("net_cost") @db.Decimal(12, 2)
  netSales     Decimal            @map("net_sales") @db.Decimal(12, 2)
  profit       Decimal            @map("profit") @db.Decimal(12, 2)
  createdAt    DateTime           @default(now()) @map("created_at")
  canceledAt   DateTime?          @map("canceled_at")
  tenantId     String             @map("tenant_id")
  payables     Payable[]
  payments     Payment[]
  adjustments  TicketAdjustment[]
  customer     Customer?          @relation(fields: [customerId], references: [id])
  tenant       Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, ticketNumber])
  @@index([tenantId])
  @@map("tickets")
}

model TicketAdjustment {
  id               String   @id @default(cuid())
  ticketId         String   @map("ticket_id")
  previousNetSales Decimal  @default(0) @map("previous_net_sales") @db.Decimal(12, 2)
  previousNetCost  Decimal  @default(0) @map("previous_net_cost") @db.Decimal(12, 2)
  newNetSales      Decimal  @default(0) @map("new_net_sales") @db.Decimal(12, 2)
  newNetCost       Decimal  @default(0) @map("new_net_cost") @db.Decimal(12, 2)
  reason           String?  @map("reason")
  date             DateTime @map("date")
  createdAt        DateTime @default(now()) @map("created_at")
  ticket           Ticket   @relation(fields: [ticketId], references: [id], onDelete: Cascade)

  @@index([ticketId])
  @@map("ticket_adjustments")
}

model Visa {
  id               String    @id @default(cuid())
  visaNumber       Int?      @map("visa_number")
  reference        String    @default("") @map("reference")
  date             DateTime  @map("date")
  month            String    @map("month")
  sponsor          String?   @map("sponsor")
  customerId       String?   @map("customer_id")
  customer         String?   @map("customer")
  country          String?   @map("country")
  netCost          Decimal   @map("net_cost") @db.Decimal(12, 2)
  netSales         Decimal   @map("net_sales") @db.Decimal(12, 2)
  profit           Decimal   @map("profit") @db.Decimal(12, 2)
  createdAt        DateTime  @default(now()) @map("created_at")
  canceledAt       DateTime? @map("canceled_at")
  tenantId         String    @map("tenant_id")
  payables         Payable[]
  payments         Payment[]
  customerRelation Customer? @relation(fields: [customerId], references: [id])
  tenant           Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, visaNumber])
  @@index([tenantId])
  @@map("visas")
}

model Expense {
  id           String    @id @default(cuid())
  date         DateTime  @map("date")
  month        String    @map("month")
  amount       Decimal   @map("amount") @db.Decimal(12, 2)
  description  String?   @map("description")
  category     String?   @map("category")
  employeeId   String?   @map("employee_id")
  paidBy       String?   @map("paid_by")
  receivedBy   String?   @map("received_by")
  pMethod      String?   @map("p_method")
  account      String?   @map("account")
  status       String    @default("pending") @map("status")
  approvedAt   DateTime? @map("approved_at")
  approvedById String?   @map("approved_by_id")
  createdAt    DateTime  @default(now()) @map("created_at")
  currency     String    @default("USD") @map("currency")
  tenantId     String    @map("tenant_id")
  approvedBy   User?     @relation(fields: [approvedById], references: [id])
  employee     Employee? @relation(fields: [employeeId], references: [id])
  tenant       Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([employeeId])
  @@index([category])
  @@index([status])
  @@map("expenses")
}

model Payable {
  id                String           @id @default(cuid())
  date              DateTime         @map("date")
  month             String           @map("month")
  invoice           String?          @map("invoice")
  name              String?          @map("name")
  description       String?          @map("description")
  amount            Decimal          @map("amount") @db.Decimal(12, 2)
  balance           Decimal          @map("balance") @db.Decimal(12, 2)
  deadline          DateTime?        @map("deadline")
  remaining         Int?             @map("remaining")
  ticketId          String?          @map("ticket_id")
  visaId            String?          @map("visa_id")
  hajUmrahBookingId String?          @map("haj_umrah_booking_id")
  createdAt         DateTime         @default(now()) @map("created_at")
  canceledAt        DateTime?        @map("canceled_at")
  tenantId          String           @map("tenant_id")
  payments          PayablePayment[]
  hajUmrahBooking   HajUmrahBooking? @relation(fields: [hajUmrahBookingId], references: [id])
  tenant            Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ticket            Ticket?          @relation(fields: [ticketId], references: [id])
  visa              Visa?            @relation(fields: [visaId], references: [id])

  @@index([tenantId])
  @@index([ticketId])
  @@index([visaId])
  @@index([hajUmrahBookingId])
  @@map("payables")
}

model PayablePayment {
  id          String    @id @default(cuid())
  date        DateTime  @map("date")
  amount      Decimal   @map("amount") @db.Decimal(12, 2)
  pMethod     String?   @map("p_method")
  account     String?   @map("account")
  reference   String?   @map("reference")
  status      String    @default("pending") @map("status")
  submittedBy String?   @map("submitted_by")
  approvedBy  String?   @map("approved_by")
  approvedAt  DateTime? @map("approved_at")
  paidBy      String?   @map("paid_by")
  paidAt      DateTime? @map("paid_at")
  payableId   String    @map("payable_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  payable     Payable   @relation(fields: [payableId], references: [id], onDelete: Cascade)

  @@index([payableId])
  @@index([status])
  @@map("payable_payments")
}

model Payment {
  id                String           @id @default(cuid())
  date              DateTime         @map("date")
  month             String           @map("month")
  status            String           @default("pending") @map("status")
  expectedDate      DateTime?        @map("expected_date")
  name              String?          @map("name")
  description       String?          @map("description")
  amount            Decimal          @map("amount") @db.Decimal(12, 2)
  ticketId          String?          @map("ticket_id")
  visaId            String?          @map("visa_id")
  hajUmrahBookingId String?          @map("haj_umrah_booking_id")
  createdAt         DateTime         @default(now()) @map("created_at")
  canceledAt        DateTime?        @map("canceled_at")
  paymentDate       DateTime         @default(now()) @map("payment_date")
  currency          String           @default("USD") @map("currency")
  cargoShipmentId   String?          @map("cargo_shipment_id")
  tenantId          String           @map("tenant_id")
  cargoShipment     CargoShipment?   @relation(fields: [cargoShipmentId], references: [id])
  hajUmrahBooking   HajUmrahBooking? @relation(fields: [hajUmrahBookingId], references: [id])
  tenant            Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  ticket            Ticket?          @relation(fields: [ticketId], references: [id])
  visa              Visa?            @relation(fields: [visaId], references: [id])
  receipts          Receipt[]

  @@index([tenantId])
  @@index([ticketId])
  @@index([visaId])
  @@index([hajUmrahBookingId])
  @@index([cargoShipmentId])
  @@map("payments")
}

model Receipt {
  id              String   @id @default(cuid())
  date            DateTime @map("date")
  amount          Decimal  @map("amount") @db.Decimal(12, 2)
  pMethod         String?  @map("p_method")
  account         String?  @map("account")
  receivedBy      String?  @map("received_by")
  paymentId       String   @map("payment_id")
  createdAt       DateTime @default(now()) @map("created_at")
  currency        String   @default("USD") @map("currency")
  rateToBase      Decimal? @map("rate_to_base") @db.Decimal(12, 8)
  collectionPoint String?  @map("collection_point")
  payment         Payment  @relation(fields: [paymentId], references: [id], onDelete: Cascade)

  @@index([paymentId])
  @@map("receipts")
}

model HajUmrahCampaign {
  id         String            @id @default(cuid())
  date       DateTime          @map("date")
  month      String            @map("month")
  name       String?           @map("name")
  type       String?           @map("type")
  leaderId   String?           @map("leader_id")
  createdAt  DateTime          @default(now()) @map("created_at")
  canceledAt DateTime?         @map("canceled_at")
  returnDate DateTime?         @map("return_date")
  tenantId   String            @map("tenant_id")
  bookings   HajUmrahBooking[]
  leader     User?             @relation(fields: [leaderId], references: [id])
  tenant     Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([month])
  @@index([date])
  @@index([leaderId])
  @@map("haj_umrah_campaigns")
}

model HajUmrahPackage {
  id              String                     @id @default(cuid())
  name            String                     @map("name")
  type            String                     @map("type")
  description     String?                    @map("description")
  durationDays    Int?                       @map("duration_days")
  isActive        Boolean                    @default(true) @map("is_active")
  createdAt       DateTime                   @default(now()) @map("created_at")
  updatedAt       DateTime                   @updatedAt @map("updated_at")
  priceByCountry  Boolean                    @default(true) @map("price_by_country")
  fixedPrice      Decimal?                   @map("fixed_price") @db.Decimal(12, 2)
  tenantId        String                     @map("tenant_id")
  bookingPackages HajUmrahBookingPackage[]
  visaPrices      HajUmrahPackageVisaPrice[]
  tenant          Tenant                     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([type])
  @@index([isActive])
  @@map("haj_umrah_packages")
}

model HajUmrahPackageVisaPrice {
  id        String          @id @default(cuid())
  packageId String          @map("package_id")
  country   String          @map("country")
  price     Decimal         @map("price") @db.Decimal(12, 2)
  createdAt DateTime        @default(now()) @map("created_at")
  package   HajUmrahPackage @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@unique([packageId, country])
  @@index([packageId])
  @@map("haj_umrah_package_visa_prices")
}

model HajUmrahBooking {
  id              String                   @id @default(cuid())
  trackNumber     Int?                     @map("track_number")
  campaignId      String?                  @map("campaign_id")
  customerId      String                   @map("customer_id")
  date            DateTime                 @map("date")
  month           String                   @map("month")
  status          String                   @default("draft") @map("status")
  notes           String?                  @map("notes")
  createdAt       DateTime                 @default(now()) @map("created_at")
  canceledAt      DateTime?                @map("canceled_at")
  profit          Decimal?                 @map("profit") @db.Decimal(12, 2)
  passportCountry String?                  @map("passport_country")
  tenantId        String                   @map("tenant_id")
  packages        HajUmrahBookingPackage[]
  campaign        HajUmrahCampaign?        @relation(fields: [campaignId], references: [id])
  customer        Customer                 @relation(fields: [customerId], references: [id])
  tenant          Tenant                   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payables        Payable[]
  payments        Payment[]

  @@unique([tenantId, trackNumber])
  @@index([tenantId])
  @@index([campaignId])
  @@index([customerId])
  @@index([month])
  @@index([status])
  @@map("haj_umrah_bookings")
}

model HajUmrahBookingPackage {
  id          String           @id @default(cuid())
  bookingId   String           @map("booking_id")
  packageId   String?          @map("package_id")
  quantity    Int              @default(1) @map("quantity")
  unitPrice   Decimal          @map("unit_price") @db.Decimal(12, 2)
  amount      Decimal          @map("amount") @db.Decimal(12, 2)
  createdAt   DateTime         @default(now()) @map("created_at")
  packageName String           @map("package_name")
  booking     HajUmrahBooking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  package     HajUmrahPackage? @relation(fields: [packageId], references: [id])

  @@unique([bookingId, packageId])
  @@index([bookingId])
  @@index([packageId])
  @@map("haj_umrah_booking_packages")
}

model CargoLocation {
  id        String   @id @default(cuid())
  name      String   @map("name")
  createdAt DateTime @default(now()) @map("created_at")
  tenantId  String   @map("tenant_id")
  branches  Branch[]
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  users     User[]

  @@unique([tenantId, name])
  @@index([tenantId])
  @@map("cargo_locations")
}

model Branch {
  id              String          @id @default(cuid())
  locationId      String          @map("location_id")
  name            String          @map("name")
  address         String?         @map("address")
  email           String?         @map("email")
  phone           String?         @map("phone")
  whatsapp        String?         @map("whatsapp")
  createdAt       DateTime        @default(now()) @map("created_at")
  updatedAt       DateTime        @updatedAt @map("updated_at")
  location        CargoLocation   @relation(fields: [locationId], references: [id], onDelete: Cascade)
  destShipments   CargoShipment[] @relation("DestinationBranch")
  sourceShipments CargoShipment[] @relation("SourceBranch")
  users           User[]

  @@unique([locationId, name])
  @@index([locationId])
  @@map("branches")
}

model CargoShipment {
  id                  String             @id @default(uuid())
  trackingNumber      String             @map("tracking_number")
  senderName          String             @map("sender_name")
  senderPhone         String             @map("sender_phone")
  receiverName        String             @map("receiver_name")
  receiverPhone       String             @map("receiver_phone")
  destination         String             @map("destination")
  totalWeight         Float              @map("total_weight")
  price               Float
  status              String
  createdAt           DateTime           @default(now()) @map("created_at")
  source              String             @default("") @map("source")
  transportMode       String             @default("air") @map("transport_mode")
  carrier             String             @default("") @map("carrier")
  currency            String             @default("USD") @map("currency")
  sourceBranchId      String?            @map("source_branch_id")
  destinationBranchId String?            @map("destination_branch_id")
  tenantId            String             @map("tenant_id")
  items               CargoItem[]
  destinationBranch   Branch?            @relation("DestinationBranch", fields: [destinationBranchId], references: [id])
  sourceBranch        Branch?            @relation("SourceBranch", fields: [sourceBranchId], references: [id])
  tenant              Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  logs                CargoTrackingLog[]
  payments            Payment[]

  @@unique([tenantId, trackingNumber])
  @@index([tenantId])
  @@index([status])
  @@index([createdAt])
  @@index([sourceBranchId])
  @@index([destinationBranchId])
  @@map("cargo_shipments")
}

model CargoItem {
  id              String        @id @default(uuid())
  cargoShipmentId String        @map("cargo_shipment_id")
  description     String
  quantity        Int
  weight          Float
  unitPrice       Float         @default(5) @map("unit_price")
  shipment        CargoShipment @relation(fields: [cargoShipmentId], references: [id], onDelete: Cascade)

  @@index([cargoShipmentId])
  @@map("cargo_items")
}

model CargoTrackingLog {
  id              String        @id @default(uuid())
  cargoShipmentId String        @map("cargo_shipment_id")
  status          String
  note            String?
  createdAt       DateTime      @default(now()) @map("created_at")
  shipment        CargoShipment @relation(fields: [cargoShipmentId], references: [id], onDelete: Cascade)

  @@index([cargoShipmentId])
  @@map("cargo_tracking_logs")
}

model CargoSequence {
  year      Int
  lastValue Int      @default(0) @map("last_value")
  updatedAt DateTime @default(now()) @updatedAt @map("updated_at")
  tenantId  String   @map("tenant_id")
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@id([tenantId, year])
  @@map("cargo_sequences")
}

// Subscription Plans
model SubscriptionPlan {
  id                 String         @id @default(cuid())
  name               String         @unique @map("name")
  displayName        String         @map("display_name")
  description        String?        @map("description")
  price              Decimal        @map("price") @db.Decimal(12, 2)
  billingInterval    String         @map("billing_interval") // monthly, quarterly, yearly
  features           String?        @map("features") // JSON string
  maxUsers           Int?           @map("max_users")
  maxStorage         Int?           @map("max_storage") // in GB
  isActive           Boolean        @default(true) @map("is_active")
  sortOrder          Int            @default(0) @map("sort_order")
  trialDays          Int?           @default(0) @map("trial_days")
  setupFee           Decimal?       @default(0) @map("setup_fee") @db.Decimal(12, 2)
  createdAt          DateTime       @default(now()) @map("created_at")
  updatedAt          DateTime       @updatedAt @map("updated_at")
  subscriptions      Subscription[]

  @@map("subscription_plans")
}

// Tenant Subscriptions
model Subscription {
  id                  String                @id @default(cuid())
  tenantId            String                @map("tenant_id")
  planId              String                @map("plan_id")
  status              String                @default("trial") @map("status") // trial, active, past_due, suspended, canceled
  startDate           DateTime              @map("start_date")
  endDate             DateTime?             @map("end_date")
  trialEndDate        DateTime?             @map("trial_end_date")
  currentPeriodStart  DateTime              @map("current_period_start")
  currentPeriodEnd    DateTime              @map("current_period_end")
  cancelAtPeriodEnd   Boolean               @default(false) @map("cancel_at_period_end")
  canceledAt          DateTime?             @map("canceled_at")
  autoRenew           Boolean               @default(true) @map("auto_renew")
  customPrice         Decimal?              @map("custom_price") @db.Decimal(12, 2)
  notes               String?               @map("notes")
  createdAt           DateTime              @default(now()) @map("created_at")
  updatedAt           DateTime              @updatedAt @map("updated_at")
  plan                SubscriptionPlan      @relation(fields: [planId], references: [id])
  tenant              Tenant                @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  payments            SubscriptionPayment[]

  @@index([tenantId])
  @@index([planId])
  @@index([status])
  @@index([currentPeriodEnd])
  @@map("subscriptions")
}

// Subscription Payment History
model SubscriptionPayment {
  id               String       @id @default(cuid())
  subscriptionId   String       @map("subscription_id")
  tenantId         String       @map("tenant_id")
  amount           Decimal      @map("amount") @db.Decimal(12, 2)
  currency         String       @default("USD") @map("currency")
  status           String       @default("pending") @map("status") // pending, paid, failed, refunded
  dueDate          DateTime     @map("due_date")
  paidDate         DateTime?    @map("paid_date")
  paymentMethod    String?      @map("payment_method") // credit_card, bank_transfer, paypal, etc
  transactionId    String?      @map("transaction_id")
  invoiceNumber    String?      @unique @map("invoice_number")
  notes            String?      @map("notes")
  periodStart      DateTime     @map("period_start")
  periodEnd        DateTime     @map("period_end")
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  subscription     Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  tenant           Tenant       @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([subscriptionId])
  @@index([tenantId])
  @@index([status])
  @@index([dueDate])
  @@map("subscription_payments")
}
